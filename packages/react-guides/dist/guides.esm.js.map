{"version":3,"file":"guides.esm.js","sources":["../src/react-guides/utils.ts","../src/react-guides/consts.ts","../src/react-guides/Guides.tsx"],"sourcesContent":["import { prefixNames } from \"framework-utils\";\n\nexport function prefix(...classNames: string[]) {\n    return prefixNames(\"scena-\", ...classNames);\n}\n","import { prefix } from \"./utils\";\nimport { prefixCSS } from \"framework-utils\";\nimport { GuidesOptions } from \"./types\";\nimport { PROPERTIES as RULER_PROPERTIES } from \"@scena/react-ruler\";\n\nexport const RULER = prefix(\"ruler\");\nexport const ADDER = prefix(\"guide\", \"adder\");\nexport const GUIDES = prefix(\"guides\");\nexport const GUIDE = prefix(\"guide\");\nexport const DRAGGING = prefix(\"dragging\");\nexport const DISPLAY_DRAG = prefix(\"display-drag\");\nexport const GUIDES_CSS = prefixCSS(\"scena-\", `\n{\n    position: relative;\n}\ncanvas {\n    position: relative;\n}\n.guide-origin {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    top: 0;\n    left: 0;\n    opacity: 0;\n}\n.guides {\n    position: absolute;\n    top: 0;\n    left: 0;\n    will-change: transform;\n    z-index: 2000;\n}\n.display-drag {\n    position: absolute;\n    will-change: transform;\n    z-index: 2000;\n    font-weight: bold;\n    font-size: 12px;\n    display: none;\n    left: 20px;\n    top: -20px;\n    color: #8f8f8f;\n}\n:host.horizontal .guides {\n    width: 100%;\n    height: 0;\n    top: 30px;\n}\n:host.vertical .guides {\n    height: 100%;\n    width: 0;\n    left: 30px;\n}\n.guide {\n    position: absolute;\n    z-index: 2;\n}\n.guide.dragging:before {\n    position: absolute;\n    content: \"\";\n    width: 100%;\n    height: 100%;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n}\n:host.horizontal .guide {\n    width: 100%;\n    height: 1px;\n    cursor: row-resize;\n}\n:host.vertical .guide {\n    width: 1px;\n    height: 100%;\n    cursor: col-resize;\n}\n.mobile :host.horizontal .guide {\n    transform: scale(1, 2);\n}\n.mobile :host.vertical .guide {\n    transform: scale(2, 1);\n}\n:host.horizontal .guide:before {\n    height: 20px;\n}\n:host.vertical .guide:before {\n    width: 20px;\n}\n.adder {\n    display: none;\n}\n.adder.dragging {\n    display: block;\n}\n`);\n\nexport const PROPERTIES: Array<keyof GuidesOptions> = [\n    \"className\",\n    \"rulerStyle\",\n    'snapThreshold',\n    \"snaps\",\n    \"displayDragPos\",\n    \"cspNonce\",\n    'dragPosFormat',\n    \"defaultGuides\",\n    \"showGuides\",\n    ...RULER_PROPERTIES,\n];\n\nexport const METHODS = [\n    \"getGuides\",\n    \"loadGuides\",\n    \"scroll\",\n    \"scrollGuides\",\n    \"resize\",\n] as const;\n\nexport const EVENTS = [\n    \"changeGuides\",\n    \"dragStart\",\n    \"drag\",\n    \"dragEnd\",\n] as const;\n","import { addClass, hasClass, removeClass } from '@daybrush/utils';\nimport Ruler, {\n  PROPERTIES as RULER_PROPERTIES,\n  RulerProps,\n} from '@scena/react-ruler';\nimport { calculateMatrixDist, getDistElementMatrix } from 'css-to-mat';\nimport { ref, refs } from 'framework-utils';\nimport Gesto, { OnDragEnd } from 'gesto';\nimport * as React from 'react';\nimport styled, { StyledElement } from 'react-css-styled';\n\nimport {\n  ADDER,\n  DISPLAY_DRAG,\n  DRAGGING,\n  GUIDE,\n  GUIDES,\n  GUIDES_CSS,\n} from './consts';\nimport {\n  BorderStyle,\n  GuidesInterface,\n  GuidesProps,\n  GuidesState,\n} from './types';\nimport { prefix } from './utils';\n\nconst GuidesElement = styled('div', GUIDES_CSS);\n\nexport default class Guides\n  extends React.PureComponent<GuidesProps, GuidesState>\n  implements GuidesInterface {\n  public static defaultProps: GuidesProps = {\n    className: '',\n    defaultGuides: [],\n    deleteOnDblclick: true,\n    digit: 0,\n    displayDragPos: false,\n    dragPosFormat: (v) => v,\n    guidesColor: '#8f8f8f',\n    guidesStyle: 'dashed',\n    lockGuides: false,\n    onChangeGuides: () => {},\n    onDrag: () => {},\n    onDragEnd: () => {},\n    onDragStart: () => {},\n    showGuides: true,\n    snapThreshold: 5,\n    snaps: [],\n    style: { height: '100%', width: '100%' },\n    type: 'horizontal',\n    zoom: 1,\n  };\n  public state: GuidesState = {\n    guides: [],\n  };\n  public adderElement!: HTMLElement;\n  public scrollPos = 0;\n  public ruler!: Ruler;\n  private manager!: StyledElement<HTMLElement>;\n  private guidesElement!: HTMLElement;\n  private displayElement!: HTMLElement;\n  private originElement!: HTMLElement;\n  private gesto!: Gesto;\n  private guideElements: HTMLElement[] = [];\n\n  // DES2-1606, delay create till drg\n  private isTrackingCreate = false; // tracking beginning and end of create sequence\n  private canCreate = false; // signal if mouse out of ruler area\n  private created = false; // signal if new guide was added\n\n  public render() {\n    const {\n      className,\n      guidesColor,\n      type,\n      zoom,\n      style,\n      rulerStyle,\n      displayDragPos,\n      cspNonce,\n    } = this.props as Required<GuidesProps>;\n    const props = this.props;\n    const translateName = this.getTranslateName();\n\n    const rulerProps: RulerProps = {};\n\n    RULER_PROPERTIES.forEach((name) => {\n      if (name === 'style') {\n        return;\n      }\n      (rulerProps as any)[name] = props[name];\n    });\n\n    const { draggingGuideStyle, staticGuideStyle } = this.getGuideColorStyle(\n      type,\n      guidesColor,\n    );\n\n    return (\n      <GuidesElement\n        className={`${prefix('manager', type)} ${className}`}\n        cspNonce={cspNonce}\n        ref={ref(this, 'manager')}\n        style={style}\n      >\n        <div\n          className={prefix('guide-origin')}\n          ref={ref(this, 'originElement')}\n        ></div>\n        <Ruler ref={ref(this, 'ruler')} style={rulerStyle} {...rulerProps} />\n        <div\n          className={GUIDES}\n          ref={ref(this, 'guidesElement')}\n          style={{\n            transform: `${translateName}(${-this.scrollPos * zoom}px)`,\n          }}\n        >\n          {displayDragPos && (\n            <div\n              className={DISPLAY_DRAG}\n              ref={ref(this, 'displayElement')}\n              style={{ color: this.props.guidesColor }}\n            />\n          )}\n          <div\n            className={ADDER}\n            ref={ref(this, 'adderElement')}\n            style={draggingGuideStyle}\n          />\n          {this.renderGuides(staticGuideStyle)}\n        </div>\n      </GuidesElement>\n    );\n  }\n\n  private getGuideColorStyle(type: string, guidesColor: string) {\n    const guideColorStyle = (guidesStyle: BorderStyle): React.CSSProperties =>\n      type === 'horizontal'\n        ? { borderTop: `1px ${guidesStyle} ${guidesColor}` }\n        : { borderLeft: `1px ${guidesStyle} ${guidesColor}` };\n\n    const draggingGuideStyle: React.CSSProperties = {\n      ...guideColorStyle('solid'),\n    };\n    const staticGuideStyle: React.CSSProperties = {\n      ...guideColorStyle(this.props.guidesStyle),\n    };\n    return { draggingGuideStyle, staticGuideStyle };\n  }\n\n  public renderGuides(staticGuideStyle: React.CSSProperties) {\n    const { type, zoom, showGuides } = this.props as Required<GuidesProps>;\n    const translateName = this.getTranslateName();\n    const guides = this.state.guides;\n\n    this.guideElements = [];\n    if (showGuides) {\n      return guides.map((pos, i) => {\n        return (\n          <div\n            className={prefix('guide', type)}\n            data-index={i}\n            data-pos={pos}\n            key={i}\n            ref={refs(this, 'guideElements', i)}\n            style={{\n              ...staticGuideStyle,\n              transform: `${translateName}(${pos * zoom}px) translateZ(0px)`,\n            }}\n          ></div>\n        );\n      });\n    }\n    return;\n  }\n\n  public componentDidMount() {\n    this.manager.getElement().addEventListener('mouseleave', this.onMouseLeave);\n    this.gesto = new Gesto(this.manager.getElement(), {\n      container: document.body,\n    })\n      .on('dragStart', (e) => {\n        const { type, zoom, lockGuides } = this.props;\n\n        if (lockGuides === true) {\n          e.stop();\n          return;\n        }\n        const inputEvent = e.inputEvent;\n        const target = inputEvent.target;\n        const datas = e.datas;\n        const canvasElement = this.ruler.canvasElement;\n        const guidesElement = this.guidesElement;\n        const isHorizontal = type === 'horizontal';\n        const originRect = this.originElement.getBoundingClientRect();\n        const matrix = getDistElementMatrix(this.manager.getElement());\n        const offsetPos = calculateMatrixDist(matrix, [\n          e.clientX - originRect.left,\n          e.clientY - originRect.top,\n        ]);\n        offsetPos[0] -= guidesElement.offsetLeft;\n        offsetPos[1] -= guidesElement.offsetTop;\n        offsetPos[isHorizontal ? 1 : 0] += this.scrollPos * zoom!;\n\n        datas.offsetPos = offsetPos;\n        datas.matrix = matrix;\n\n        const isLockAdd = lockGuides && lockGuides.indexOf('add') > -1;\n        const isLockRemove = lockGuides && lockGuides.indexOf('remove') > -1;\n        const isLockChange = lockGuides && lockGuides.indexOf('change') > -1;\n\n        if (target === canvasElement) {\n          if (isLockAdd) {\n            e.stop();\n            return;\n          }\n          datas.fromRuler = true;\n          datas.target = this.adderElement;\n          // add\n        } else if (hasClass(target, GUIDE)) {\n          if (isLockRemove && isLockChange) {\n            e.stop();\n            return;\n          }\n          datas.target = target;\n          // change\n        } else {\n          e.stop();\n          return false;\n        }\n        this.onDragStart(e);\n      })\n      .on('drag', this.onDrag)\n      .on('dragEnd', this.onDragEnd);\n    this.setState({ guides: this.props.defaultGuides || [] }); // pass array of guides on mount data to create gridlines or something like that in ui\n  }\n  public componentWillUnmount() {\n    this.manager\n      .getElement()\n      .removeEventListener('mouseleave', this.onMouseLeave);\n    this.gesto.unset();\n  }\n  public componentDidUpdate(prevProps: any) {\n    if (prevProps.defaultGuides !== this.props.defaultGuides) {\n      // to dynamically update guides from code rather than dragging guidelines\n      this.setState({ guides: this.props.defaultGuides || [] });\n    }\n  }\n  /**\n   * Load the current guidelines.\n   * @memberof Guides\n   * @instance\n   */\n  public loadGuides(guides: number[]) {\n    this.setState({\n      guides,\n    });\n  }\n  /**\n   * Get current guidelines.\n   * @memberof Guides\n   * @instance\n   */\n  public getGuides(): number[] {\n    return this.state.guides;\n  }\n  /**\n   * Scroll the positions of the guidelines opposite the ruler.\n   * @memberof Guides\n   * @instance\n   */\n  public scrollGuides(pos: number) {\n    const { zoom } = this.props as Required<GuidesProps>;\n    const guidesElement = this.guidesElement;\n\n    this.scrollPos = pos;\n    guidesElement.style.transform = `${this.getTranslateName()}(${\n      -pos * zoom\n    }px)`;\n\n    const guides = this.state.guides;\n    this.guideElements.forEach((el, i) => {\n      if (!el) {\n        return;\n      }\n      el.style.display = -pos + guides[i] < 0 ? 'none' : 'block';\n    });\n  }\n  /**\n   * Recalculate the size of the ruler.\n   * @memberof Guides\n   * @instance\n   */\n  public resize() {\n    this.ruler.resize();\n  }\n  /**\n   * Scroll the position of the ruler.\n   * @memberof Guides\n   * @instance\n   */\n  public scroll(pos: number) {\n    this.ruler.scroll(pos);\n  }\n\n  private onDragStart = (e: any) => {\n    const { inputEvent, datas } = e;\n\n    if (!datas.fromRuler) addClass(datas.target, DRAGGING);\n    else {\n      this.isTrackingCreate = true;\n      // allow touch create to skip mouseleave logic\n      if (inputEvent.type === 'touchstart') this.canCreate = true;\n    }\n\n    inputEvent.stopPropagation();\n    inputEvent.preventDefault();\n  };\n\n  private onMouseLeave = () => {\n    if (this.isTrackingCreate) this.canCreate = true;\n  };\n\n  private onDrag = (e: any) => {\n    if (e.datas.fromRuler) {\n      if (!this.canCreate && !this.created) {\n        // do not create till mouseleave the ruler\n        return;\n      }\n      if (this.canCreate && !this.created) {\n        // DES2-1606, delay create till drg\n        addClass(e.datas.target, DRAGGING);\n        this.props.onDragStart!({\n          ...e,\n          dragElement: e.datas.target,\n        });\n        this.created = true;\n      }\n    }\n\n    const nextPos = this.movePos(e);\n\n    /**\n     * When dragging, the drag event is called.\n     * @memberof Guides\n     * @event drag\n     * @param {OnDrag} - Parameters for the drag event\n     */\n    this.props.onDrag!({\n      ...e,\n      dragElement: e.datas.target,\n    });\n    return nextPos;\n  };\n\n  private cleanupCreate = () => {\n    // DES2-1606, delay create till drg\n    this.canCreate = false;\n    this.created = false;\n    this.isTrackingCreate = false;\n  };\n\n  private onDragEnd = (e: OnDragEnd) => {\n    const { datas, isDouble, distX, distY } = e;\n    const pos = this.movePos(e);\n    let guides = this.state.guides;\n    const {\n      onChangeGuides,\n      zoom,\n      displayDragPos,\n      digit,\n      lockGuides,\n    } = this.props;\n    const guidePos = parseFloat((pos / zoom!).toFixed(digit || 0));\n\n    if (displayDragPos) {\n      this.displayElement.style.cssText += `display: none;`;\n    }\n    removeClass(datas.target, DRAGGING);\n    /**\n     * When the drag finishes, the dragEnd event is called.\n     * @memberof Guides\n     * @event dragEnd\n     * @param {OnDragEnd} - Parameters for the dragEnd event\n     */\n    this.props.onDragEnd!({\n      ...e,\n      dragElement: datas.target,\n    });\n    /**\n     * The `changeGuides` event occurs when the guideline is added / removed / changed.\n     * @memberof Guides\n     * @event changeGuides\n     * @param {OnChangeGuides} - Parameters for the changeGuides event\n     */\n    if (datas.fromRuler) {\n      // DES2-1852, remove position restriction\n      // if (pos >= this.scrollPos && guides.indexOf(guidePos) < 0) {\n      if (guides.indexOf(guidePos) < 0) {\n        // DES2-1606, delay create till drg\n        if (this.created) {\n          if (guidePos < this.scrollPos) {\n            // do not create if dragEnd on the ruler\n            this.cleanupCreate();\n            return;\n          }\n          this.setState(\n            {\n              guides: [...guides, guidePos],\n            },\n            () => {\n              onChangeGuides!({\n                distX,\n                distY,\n                guides: this.state.guides,\n                isAdd: true,\n                isChange: false,\n                isRemove: false,\n              });\n            },\n          );\n        }\n      }\n    } else {\n      const index = datas.target.getAttribute('data-index');\n      let isRemove = false;\n      let isChange = false;\n\n      guides = [...guides];\n      const deleteOnDblclick = this.props.deleteOnDblclick && isDouble;\n\n      if (deleteOnDblclick || guidePos < this.scrollPos) {\n        if (\n          lockGuides &&\n          (lockGuides === true || lockGuides.indexOf('remove') > -1)\n        ) {\n          this.cleanupCreate();\n          return;\n        }\n        guides.splice(index, 1);\n        isRemove = true;\n      } else if (guides.indexOf(guidePos) > -1) {\n        this.cleanupCreate();\n        return;\n      } else {\n        if (\n          lockGuides &&\n          (lockGuides === true || lockGuides.indexOf('change') > -1)\n        ) {\n          this.cleanupCreate();\n          return;\n        }\n        guides[index] = guidePos;\n        isChange = true;\n      }\n      this.setState(\n        {\n          guides,\n        },\n        () => {\n          const nextGuides = this.state.guides;\n          onChangeGuides!({\n            distX,\n            distY,\n            guides: nextGuides,\n            isAdd: false,\n            isChange,\n            isRemove,\n          });\n        },\n      );\n    }\n    this.cleanupCreate();\n  };\n\n  private movePos(e: any) {\n    const { datas, distX, distY } = e;\n    const props = this.props;\n    const { type, zoom, snaps, snapThreshold, displayDragPos, digit } = props;\n    const dragPosFormat = props.dragPosFormat || ((v) => v);\n    const isHorizontal = type === 'horizontal';\n    const matrixPos = calculateMatrixDist(datas.matrix, [distX, distY]);\n    const offsetPos = datas.offsetPos;\n    const offsetX = matrixPos[0] + offsetPos[0];\n    const offsetY = matrixPos[1] + offsetPos[1];\n    let nextPos = Math.round(isHorizontal ? offsetY : offsetX);\n    let guidePos = parseFloat((nextPos / zoom!).toFixed(digit || 0));\n    const guideSnaps = snaps!.slice().sort((a, b) => {\n      return Math.abs(guidePos - a) - Math.abs(guidePos - b);\n    });\n\n    if (\n      guideSnaps.length &&\n      Math.abs(guideSnaps[0] * zoom! - nextPos) < snapThreshold!\n    ) {\n      guidePos = guideSnaps[0];\n      nextPos = guidePos * zoom!;\n    }\n    if (displayDragPos) {\n      const displayPos =\n        type === 'horizontal' ? [offsetX, nextPos] : [nextPos, offsetY];\n      this.displayElement.style.cssText += `display: block;transform: translate(-50%, -50%) translate(${displayPos\n        .map((v) => `${v}px`)\n        .join(', ')})`;\n      this.displayElement.innerHTML = `${dragPosFormat!(guidePos)}`;\n    }\n    datas.target.setAttribute('data-pos', guidePos);\n    datas.target.style.transform = `${this.getTranslateName()}(${nextPos}px)`;\n\n    return nextPos;\n  }\n  private getTranslateName() {\n    return this.props.type === 'horizontal' ? 'translateY' : 'translateX';\n  }\n}\n"],"names":["prefix","_i","classNames","prefixNames","RULER","ADDER","GUIDES","GUIDE","DRAGGING","DISPLAY_DRAG","GUIDES_CSS","prefixCSS","PROPERTIES","RULER_PROPERTIES","METHODS","EVENTS","GuidesElement","styled","tslib_1","_this","guides","e","inputEvent","datas","fromRuler","addClass","target","isTrackingCreate","type","canCreate","stopPropagation","preventDefault","created","props","onDragStart","dragElement","nextPos","movePos","onDrag","isDouble","distX","distY","pos","state","_a","onChangeGuides","zoom","displayDragPos","digit","lockGuides","guidePos","parseFloat","toFixed","displayElement","style","cssText","removeClass","onDragEnd","indexOf","scrollPos","cleanupCreate","setState","isAdd","isChange","isRemove","index","getAttribute","isRemove_1","isChange_1","deleteOnDblclick","splice","nextGuides","className","guidesColor","rulerStyle","cspNonce","translateName","getTranslateName","rulerProps","forEach","name","_b","draggingGuideStyle","staticGuideStyle","React","ref","Ruler","transform","color","renderGuides","guideColorStyle","guidesStyle","borderTop","borderLeft","showGuides","guideElements","map","i","key","refs","manager","getElement","addEventListener","onMouseLeave","gesto","Gesto","container","document","body","on","stop","canvasElement","ruler","guidesElement","isHorizontal","originRect","originElement","getBoundingClientRect","matrix","getDistElementMatrix","offsetPos","calculateMatrixDist","clientX","left","clientY","top","offsetLeft","offsetTop","isLockAdd","isLockRemove","isLockChange","adderElement","hasClass","defaultGuides","removeEventListener","unset","prevProps","el","display","resize","scroll","snaps","snapThreshold","dragPosFormat","v","matrixPos","offsetX","offsetY","Math","round","guideSnaps","slice","sort","a","b","abs","length","displayPos","join","innerHTML","setAttribute","Guides","height","width"],"mappings":"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"}