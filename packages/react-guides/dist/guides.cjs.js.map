{"version":3,"file":"guides.cjs.js","sources":["../src/react-guides/utils.ts","../src/react-guides/consts.ts","../src/react-guides/Guides.tsx","../src/react-guides/index.umd.ts"],"sourcesContent":["import { prefixNames } from \"framework-utils\";\n\nexport function prefix(...classNames: string[]) {\n    return prefixNames(\"scena-\", ...classNames);\n}\n","import { prefix } from \"./utils\";\nimport { prefixCSS } from \"framework-utils\";\nimport { GuidesOptions } from \"./types\";\nimport { PROPERTIES as RULER_PROPERTIES } from \"@scena/react-ruler\";\n\nexport const RULER = prefix(\"ruler\");\nexport const ADDER = prefix(\"guide\", \"adder\");\nexport const GUIDES = prefix(\"guides\");\nexport const GUIDE = prefix(\"guide\");\nexport const DRAGGING = prefix(\"dragging\");\nexport const DISPLAY_DRAG = prefix(\"display-drag\");\nexport const GUIDES_CSS = prefixCSS(\"scena-\", `\n{\n    position: relative;\n}\ncanvas {\n    position: relative;\n}\n.guide-origin {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    top: 0;\n    left: 0;\n    opacity: 0;\n}\n.guides {\n    position: absolute;\n    top: 0;\n    left: 0;\n    will-change: transform;\n    z-index: 2000;\n}\n.display-drag {\n    position: absolute;\n    will-change: transform;\n    z-index: 2000;\n    font-weight: bold;\n    font-size: 12px;\n    display: none;\n    left: 20px;\n    top: -20px;\n    color: #8f8f8f;\n}\n:host.horizontal .guides {\n    width: 100%;\n    height: 0;\n    top: 30px;\n}\n:host.vertical .guides {\n    height: 100%;\n    width: 0;\n    left: 30px;\n}\n.guide {\n    position: absolute;\n    z-index: 2;\n}\n.guide.dragging:before {\n    position: absolute;\n    content: \"\";\n    width: 100%;\n    height: 100%;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n}\n:host.horizontal .guide {\n    width: 100%;\n    height: 1px;\n    cursor: row-resize;\n}\n:host.vertical .guide {\n    width: 1px;\n    height: 100%;\n    cursor: col-resize;\n}\n.mobile :host.horizontal .guide {\n    transform: scale(1, 2);\n}\n.mobile :host.vertical .guide {\n    transform: scale(2, 1);\n}\n:host.horizontal .guide:before {\n    height: 20px;\n}\n:host.vertical .guide:before {\n    width: 20px;\n}\n.adder {\n    display: none;\n}\n.adder.dragging {\n    display: block;\n}\n`);\n\nexport const PROPERTIES: Array<keyof GuidesOptions> = [\n    \"className\",\n    \"rulerStyle\",\n    'snapThreshold',\n    \"snaps\",\n    \"displayDragPos\",\n    \"cspNonce\",\n    'dragPosFormat',\n    \"defaultGuides\",\n    \"showGuides\",\n    ...RULER_PROPERTIES,\n];\n\nexport const METHODS = [\n    \"getGuides\",\n    \"loadGuides\",\n    \"scroll\",\n    \"scrollGuides\",\n    \"resize\",\n] as const;\n\nexport const EVENTS = [\n    \"changeGuides\",\n    \"dragStart\",\n    \"drag\",\n    \"dragEnd\",\n] as const;\n","import * as React from \"react\";\nimport Ruler, { PROPERTIES as RULER_PROPERTIES, RulerProps } from \"@scena/react-ruler\";\nimport { ref, refs } from \"framework-utils\";\nimport Gesto, { OnDragEnd } from \"gesto\";\nimport styled, { StyledElement } from \"react-css-styled\";\nimport { GUIDES, GUIDE, DRAGGING, ADDER, DISPLAY_DRAG, GUIDES_CSS } from \"./consts\";\nimport { prefix } from \"./utils\";\nimport { hasClass, addClass, removeClass } from \"@daybrush/utils\";\nimport { GuidesState, GuidesProps, GuidesInterface, BorderStyle } from \"./types\";\nimport { getDistElementMatrix, calculateMatrixDist } from \"css-to-mat\";\n\nconst GuidesElement = styled(\"div\", GUIDES_CSS);\n\nexport default class Guides extends React.PureComponent<GuidesProps, GuidesState> implements GuidesInterface {\n    public static defaultProps: GuidesProps = {\n        className: \"\",\n        type: \"horizontal\",\n        zoom: 1,\n        style: { width: \"100%\", height: \"100%\" },\n        snapThreshold: 5,\n        snaps: [],\n        digit: 0,\n        onChangeGuides: () => { },\n        onDragStart: () => { },\n        onDrag: () => { },\n        onDragEnd: () => { },\n        displayDragPos: false,\n        dragPosFormat: v => v,\n        defaultGuides: [],\n        guidesStyle: 'dashed',\n        guidesColor: '#8f8f8f',\n        lockGuides: false,\n        showGuides: true,\n        deleteOnDblclick: true,\n    };\n    public state: GuidesState = {\n        guides: [],\n    };\n    public adderElement!: HTMLElement;\n    public scrollPos: number = 0;\n    public ruler!: Ruler;\n    private manager!: StyledElement<HTMLElement>;\n    private guidesElement!: HTMLElement;\n    private displayElement!: HTMLElement;\n    private originElement!: HTMLElement;\n    private gesto!: Gesto;\n    private guideElements: HTMLElement[] = [];\n\n    public render() {\n        const {\n            className,\n            guidesColor,\n            type,\n            zoom,\n            style,\n            rulerStyle,\n            displayDragPos,\n            cspNonce,\n        } = this.props as Required<GuidesProps>;\n        const props = this.props;\n        const translateName = this.getTranslateName();\n\n\n        const rulerProps: RulerProps = {};\n\n        RULER_PROPERTIES.forEach(name => {\n            if (name === \"style\") {\n                return;\n            }\n            (rulerProps as any)[name] = props[name];\n        });\n\n        const { draggingGuideStyle, staticGuideStyle } = this.getGuideColorStyle(type, guidesColor);\n\n        return <GuidesElement\n            ref={ref(this, \"manager\")}\n            cspNonce={cspNonce}\n            className={`${prefix(\"manager\", type)} ${className}`}\n            style={style}\n        >\n            <div className={prefix(\"guide-origin\")} ref={ref(this, \"originElement\")}></div>\n            <Ruler\n                ref={ref(this, \"ruler\")}\n                style={rulerStyle}\n                {...rulerProps}\n            />\n            <div className={GUIDES} ref={ref(this, \"guidesElement\")} style={{\n                transform: `${translateName}(${-this.scrollPos * zoom}px)`,\n            }}>\n                {displayDragPos && <div className={DISPLAY_DRAG} ref={ref(this, \"displayElement\")}  style={{ color: this.props.guidesColor }} />}\n                <div className={ADDER} ref={ref(this, \"adderElement\")} style={draggingGuideStyle} />\n                {this.renderGuides(staticGuideStyle)}\n            </div>\n        </GuidesElement>;\n    }\n\n\n    private getGuideColorStyle(type: string, guidesColor: string) {\n        const guideColorStyle = (guidesStyle: BorderStyle): React.CSSProperties => type === \"horizontal\"\n            ? { borderTop: `1px ${guidesStyle} ${guidesColor}` }\n            : { borderLeft: `1px ${guidesStyle} ${guidesColor}` };\n\n        const draggingGuideStyle: React.CSSProperties = { ...guideColorStyle(\"solid\") };\n        const staticGuideStyle: React.CSSProperties = { ...guideColorStyle(this.props.guidesStyle) };\n        return { draggingGuideStyle, staticGuideStyle };\n    }\n\n    public renderGuides(staticGuideStyle: React.CSSProperties) {\n        const { type, zoom, showGuides } = this.props as Required<GuidesProps>;\n        const translateName = this.getTranslateName();\n        const guides = this.state.guides;\n\n        this.guideElements = [];\n        if (showGuides) {\n            return guides.map((pos, i) => {\n                return (<div className={prefix(\"guide\", type)}\n                    ref={refs(this, \"guideElements\", i)}\n                    key={i}\n                    data-index={i}\n                    data-pos={pos}\n                    style={{\n                        ...staticGuideStyle,\n                        transform: `${translateName}(${pos * zoom}px) translateZ(0px)`,\n                    }}></div>);\n            });\n        }\n        return;\n    }\n    public componentDidMount() {\n        this.gesto = new Gesto(this.manager.getElement(), {\n            container: document.body,\n        }).on(\"dragStart\", e => {\n            const {\n                type,\n                zoom,\n                lockGuides,\n            } = this.props;\n\n            if (lockGuides === true) {\n                e.stop();\n                return;\n            }\n            const inputEvent = e.inputEvent;\n            const target = inputEvent.target;\n            const datas = e.datas;\n            const canvasElement = this.ruler.canvasElement;\n            const guidesElement = this.guidesElement;\n            const isHorizontal = type === \"horizontal\";\n            const originRect = this.originElement.getBoundingClientRect();\n            const matrix = getDistElementMatrix(this.manager.getElement());\n            const offsetPos = calculateMatrixDist(matrix, [\n                e.clientX - originRect.left,\n                e.clientY - originRect.top,\n            ]);\n            offsetPos[0] -= guidesElement.offsetLeft;\n            offsetPos[1] -= guidesElement.offsetTop;\n            offsetPos[isHorizontal ? 1 : 0] += this.scrollPos * zoom!;\n\n            datas.offsetPos = offsetPos;\n            datas.matrix = matrix;\n\n            let isLockAdd = lockGuides && lockGuides.indexOf(\"add\") > -1;\n            let isLockRemove = lockGuides && lockGuides.indexOf(\"remove\") > -1;\n            let isLockChange = lockGuides && lockGuides.indexOf(\"change\") > -1;\n\n            if (target === canvasElement) {\n                if (isLockAdd) {\n                    e.stop();\n                    return;\n                }\n                datas.fromRuler = true;\n                datas.target = this.adderElement;\n                // add\n            } else if (hasClass(target, GUIDE)) {\n                if (isLockRemove && isLockChange) {\n                    e.stop();\n                    return;\n                }\n                datas.target = target;\n                // change\n            } else {\n                e.stop();\n                return false;\n            }\n            this.onDragStart(e);\n        }).on(\"drag\", this.onDrag).on(\"dragEnd\", this.onDragEnd);\n        this.setState({ guides: this.props.defaultGuides || [] }); // pass array of guides on mount data to create gridlines or something like that in ui\n    }\n    public componentWillUnmount() {\n        this.gesto.unset();\n    }\n    public componentDidUpdate(prevProps: any) {\n        if (prevProps.defaultGuides !== this.props.defaultGuides) {\n            // to dynamically update guides from code rather than dragging guidelines\n            this.setState({ guides: this.props.defaultGuides || [] });\n        }\n    }\n    /**\n     * Load the current guidelines.\n     * @memberof Guides\n     * @instance\n     */\n    public loadGuides(guides: number[]) {\n        this.setState({\n            guides,\n        });\n    }\n    /**\n     * Get current guidelines.\n     * @memberof Guides\n     * @instance\n     */\n    public getGuides(): number[] {\n        return this.state.guides;\n    }\n    /**\n     * Scroll the positions of the guidelines opposite the ruler.\n     * @memberof Guides\n     * @instance\n     */\n    public scrollGuides(pos: number) {\n        const { zoom } = this.props as Required<GuidesProps>;\n        const guidesElement = this.guidesElement;\n\n        this.scrollPos = pos;\n        guidesElement.style.transform = `${this.getTranslateName()}(${-pos * zoom}px)`;\n\n        const guides = this.state.guides;\n        this.guideElements.forEach((el, i) => {\n            if (!el) {\n                return;\n            }\n            el.style.display = -pos + guides[i] < 0 ? \"none\" : \"block\";\n        });\n    }\n    /**\n     * Recalculate the size of the ruler.\n     * @memberof Guides\n     * @instance\n     */\n    public resize() {\n        this.ruler.resize();\n    }\n    /**\n     * Scroll the position of the ruler.\n     * @memberof Guides\n     * @instance\n     */\n    public scroll(pos: number) {\n        this.ruler.scroll(pos);\n    }\n    private onDragStart = (e: any) => {\n        const { datas, inputEvent } = e;\n        const { onDragStart, lockGuides } = this.props;\n\n        addClass(datas.target, DRAGGING);\n        this.onDrag(e);\n\n        /**\n         * When the drag starts, the dragStart event is called.\n         * @memberof Guides\n         * @event dragStart\n         * @param {OnDragStart} - Parameters for the dragStart event\n         */\n        onDragStart!({\n            ...e,\n            dragElement: datas.target,\n        });\n        inputEvent.stopPropagation();\n        inputEvent.preventDefault();\n    }\n    private onDrag = (e: any) => {\n        const nextPos = this.movePos(e);\n\n        /**\n         * When dragging, the drag event is called.\n         * @memberof Guides\n         * @event drag\n         * @param {OnDrag} - Parameters for the drag event\n         */\n        this.props.onDrag!({\n            ...e,\n            dragElement: e.datas.target,\n        });\n        return nextPos;\n    }\n    private onDragEnd = (e: OnDragEnd) => {\n        const { datas, isDouble, distX, distY } = e;\n        const pos = this.movePos(e);\n        let guides = this.state.guides;\n        const { onChangeGuides, zoom, displayDragPos, digit, lockGuides } = this.props;\n        const guidePos = parseFloat((pos / zoom!).toFixed(digit || 0));\n\n        if (displayDragPos) {\n            this.displayElement.style.cssText += `display: none;`;\n        }\n        removeClass(datas.target, DRAGGING);\n        /**\n         * When the drag finishes, the dragEnd event is called.\n         * @memberof Guides\n         * @event dragEnd\n         * @param {OnDragEnd} - Parameters for the dragEnd event\n         */\n        this.props.onDragEnd!({\n            ...e,\n            dragElement: datas.target,\n        });\n        /**\n        * The `changeGuides` event occurs when the guideline is added / removed / changed.\n        * @memberof Guides\n        * @event changeGuides\n        * @param {OnChangeGuides} - Parameters for the changeGuides event\n        */\n        if (datas.fromRuler) {\n            if (pos >= this.scrollPos && guides.indexOf(guidePos) < 0) {\n                this.setState({\n                    guides: [...guides, guidePos],\n                }, () => {\n                    onChangeGuides!({\n                        guides: this.state.guides,\n                        distX,\n                        distY,\n                        isAdd: true,\n                        isRemove: false,\n                        isChange: false,\n                    });\n                });\n            }\n        } else {\n            const index = datas.target.getAttribute(\"data-index\");\n            let isRemove = false;\n            let isChange = false;\n\n            guides = [...guides];\n            const deleteOnDblclick = this.props.deleteOnDblclick && isDouble;\n\n            if (deleteOnDblclick || guidePos < this.scrollPos) {\n                if (lockGuides && (lockGuides === true || lockGuides.indexOf(\"remove\") > -1)) {\n                    return;\n                }\n                guides.splice(index, 1);\n                isRemove = true;\n            } else if (guides.indexOf(guidePos) > -1) {\n                return;\n            } else {\n                if (lockGuides && (lockGuides === true || lockGuides.indexOf(\"change\") > -1)) {\n                    return;\n                }\n                guides[index] = guidePos;\n                isChange = true;\n            }\n            this.setState({\n                guides,\n            }, () => {\n                const nextGuides = this.state.guides;\n                onChangeGuides!({\n                    distX,\n                    distY,\n                    guides: nextGuides,\n                    isAdd: false,\n                    isChange,\n                    isRemove,\n                });\n            });\n        }\n    }\n    private movePos(e: any) {\n        const { datas, distX, distY } = e;\n        const props = this.props;\n        const {\n            type, zoom, snaps, snapThreshold,\n            displayDragPos,\n            digit,\n        } = props;\n        const dragPosFormat = props.dragPosFormat || (v => v);\n        const isHorizontal = type === \"horizontal\";\n        const matrixPos = calculateMatrixDist(datas.matrix, [distX, distY]);\n        const offsetPos = datas.offsetPos;\n        const offsetX = matrixPos[0] + offsetPos[0];\n        const offsetY = matrixPos[1] + offsetPos[1];\n        let nextPos = Math.round(isHorizontal ? offsetY : offsetX);\n        let guidePos = parseFloat((nextPos / zoom!).toFixed(digit || 0));\n        const guideSnaps = snaps!.slice().sort((a, b) => {\n            return Math.abs(guidePos - a) - Math.abs(guidePos - b);\n        });\n\n        if (guideSnaps.length && Math.abs(guideSnaps[0] * zoom! - nextPos) < snapThreshold!) {\n            guidePos = guideSnaps[0];\n            nextPos = guidePos * zoom!;\n        }\n        if (displayDragPos) {\n            const displayPos = type === \"horizontal\"\n                ? [offsetX, nextPos]\n                : [nextPos, offsetY];\n            this.displayElement.style.cssText += `display: block;transform: translate(-50%, -50%) translate(${\n                displayPos.map(v => `${v}px`).join(\", \")\n                })`;\n            this.displayElement.innerHTML = `${dragPosFormat!(guidePos)}`;\n        }\n        datas.target.setAttribute(\"data-pos\", guidePos);\n        datas.target.style.transform = `${this.getTranslateName()}(${nextPos}px)`;\n\n        return nextPos;\n\n    }\n    private getTranslateName() {\n        return this.props.type === \"horizontal\" ? \"translateY\" : \"translateX\";\n    }\n}\n","import Guides, * as others from \"./index.esm\";\n\nfor (const name in others) {\n    (Guides as any)[name] = (others as any)[name];\n}\nexport default Guides;\n"],"names":["prefix","_i","classNames","prefixNames","RULER","ADDER","GUIDES","GUIDE","DRAGGING","DISPLAY_DRAG","GUIDES_CSS","prefixCSS","PROPERTIES","RULER_PROPERTIES","METHODS","EVENTS","GuidesElement","styled","tslib_1","_this","guides","e","datas","inputEvent","_a","onDragStart","lockGuides","addClass","target","onDrag","dragElement","stopPropagation","preventDefault","nextPos","movePos","props","isDouble","distX","distY","pos","state","onChangeGuides","zoom","displayDragPos","digit","guidePos","parseFloat","toFixed","displayElement","style","cssText","removeClass","onDragEnd","fromRuler","scrollPos","indexOf","setState","isAdd","isRemove","isChange","index","getAttribute","isRemove_1","isChange_1","deleteOnDblclick","splice","nextGuides","className","guidesColor","type","rulerStyle","cspNonce","translateName","getTranslateName","rulerProps","forEach","name","_b","draggingGuideStyle","staticGuideStyle","React","ref","Ruler","transform","color","renderGuides","guideColorStyle","guidesStyle","borderTop","borderLeft","showGuides","guideElements","map","i","refs","key","gesto","Gesto","manager","getElement","container","document","body","on","stop","canvasElement","ruler","guidesElement","isHorizontal","originRect","originElement","getBoundingClientRect","matrix","getDistElementMatrix","offsetPos","calculateMatrixDist","clientX","left","clientY","top","offsetLeft","offsetTop","isLockAdd","isLockRemove","isLockChange","adderElement","hasClass","defaultGuides","unset","prevProps","el","display","resize","scroll","snaps","snapThreshold","dragPosFormat","v","matrixPos","offsetX","offsetY","Math","round","guideSnaps","slice","sort","a","b","abs","length","displayPos","join","innerHTML","setAttribute","Guides","width","height","others"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;SAEgBA;qBAAO;;OAAA,YAAAC,uBAAAA;IAAAC,cAAA,gBAAA;;;SACZC,0BAAW,MAAX,OAAA,GAAY,iBAAaD,WAAzB,CAAP;;;ACEG,IAAME,KAAK,GAAGJ,MAAM,CAAC,OAAD,CAApB;AACP,AAAO,IAAMK,KAAK,GAAGL,MAAM,CAAC,OAAD,EAAU,OAAV,CAApB;AACP,AAAO,IAAMM,MAAM,GAAGN,MAAM,CAAC,QAAD,CAArB;AACP,AAAO,IAAMO,KAAK,GAAGP,MAAM,CAAC,OAAD,CAApB;AACP,AAAO,IAAMQ,QAAQ,GAAGR,MAAM,CAAC,UAAD,CAAvB;AACP,AAAO,IAAMS,YAAY,GAAGT,MAAM,CAAC,cAAD,CAA3B;AACP,AAAO,IAAMU,UAAU,GAAGC,wBAAS,CAAC,QAAD,EAAW,64CAAX,CAA5B;AAsFP,AAAO,IAAMC,UAAU,IACnB,aACA,cACA,iBACA,SACA,kBACA,YACA,iBACA,iBACA,qBACGC,iBAVA;AAaP,AAAO,IAAMC,OAAO,GAAG,CACnB,WADmB,EAEnB,YAFmB,EAGnB,QAHmB,EAInB,cAJmB,EAKnB,QALmB,CAAhB;AAQP,AAAO,IAAMC,MAAM,GAAG,CAClB,cADkB,EAElB,WAFkB,EAGlB,MAHkB,EAIlB,SAJkB,CAAf;;AC3GP,IAAMC,aAAa,GAAGC,MAAM,CAAC,KAAD,EAAQP,UAAR,CAA5B;;AAEA;;;EAAoCQ,SAAA,OAAA,QAAA;;iBAApC;wEAAA;;IAsBWC,WAAA,GAAqB;MACxBC,MAAM,EAAE;KADL;IAIAD,eAAA,GAAoB,CAApB;IAOCA,mBAAA,GAA+B,EAA/B;;IA6MAA,iBAAA,GAAc,UAACE,CAAD;UACVC,eAAA;UAAOC,yBAAP;UACFC,gBAAA;UAAEC,4BAAF;UAAeC,0BAAf;MAENC,cAAQ,CAACL,KAAK,CAACM,MAAP,EAAepB,QAAf,CAAR;;MACAW,KAAI,CAACU,MAAL,CAAYR,CAAZ;;;;;;;;;MAQAI,WAAY,cACLJ;QACHS,WAAW,EAAER,KAAK,CAACM;QAFX,CAAZ;MAIAL,UAAU,CAACQ,eAAX;MACAR,UAAU,CAACS,cAAX;KAlBI;;IAoBAb,YAAA,GAAS,UAACE,CAAD;UACPY,OAAO,GAAGd,KAAI,CAACe,OAAL,CAAab,CAAb,CAAhB;;;;;;;;;MAQAF,KAAI,CAACgB,KAAL,CAAWN,MAAX,cACOR;QACHS,WAAW,EAAET,CAAC,CAACC,KAAF,CAAQM;QAFzB;;aAIOK,OAAP;KAbI;;IAeAd,eAAA,GAAY,UAACE,CAAD;UACRC,eAAA;UAAOc,qBAAP;UAAiBC,eAAjB;UAAwBC,eAAxB;;UACFC,GAAG,GAAGpB,KAAI,CAACe,OAAL,CAAab,CAAb,CAAZ;;UACID,MAAM,GAAGD,KAAI,CAACqB,KAAL,CAAWpB,MAAxB;UACMI,gBAAA;UAAEiB,kCAAF;UAAkBC,cAAlB;UAAwBC,kCAAxB;UAAwCC,gBAAxC;UAA+ClB,0BAA/C;UACAmB,QAAQ,GAAGC,UAAU,CAAC,CAACP,GAAG,GAAGG,IAAP,EAAcK,OAAd,CAAsBH,KAAK,IAAI,CAA/B,CAAD,CAA3B;;UAEID,cAAJ,EAAoB;QAChBxB,KAAI,CAAC6B,cAAL,CAAoBC,KAApB,CAA0BC,OAA1B,IAAqC,gBAArC;;;MAEJC,iBAAW,CAAC7B,KAAK,CAACM,MAAP,EAAepB,QAAf,CAAX;;;;;;;;MAOAW,KAAI,CAACgB,KAAL,CAAWiB,SAAX,cACO/B;QACHS,WAAW,EAAER,KAAK,CAACM;QAFvB;;;;;;;;;UAUIN,KAAK,CAAC+B,SAAV,EAAqB;YACbd,GAAG,IAAIpB,KAAI,CAACmC,SAAZ,IAAyBlC,MAAM,CAACmC,OAAP,CAAeV,QAAf,IAA2B,CAAxD,EAA2D;UACvD1B,KAAI,CAACqC,QAAL,CAAc;YACVpC,MAAM,EAAMA,MAAM,OAAN,EAAQyB,SAAR;WADhB,EAEG;YACCJ,cAAe,CAAC;cACZrB,MAAM,EAAED,KAAI,CAACqB,KAAL,CAAWpB,MADP;cAEZiB,KAAK,OAFO;cAGZC,KAAK,OAHO;cAIZmB,KAAK,EAAE,IAJK;cAKZC,QAAQ,EAAE,KALE;cAMZC,QAAQ,EAAE;aANC,CAAf;WAHJ;;OAFR,MAeO;YACGC,KAAK,GAAGtC,KAAK,CAACM,MAAN,CAAaiC,YAAb,CAA0B,YAA1B,CAAd;YACIC,UAAQ,GAAG,KAAf;YACIC,UAAQ,GAAG,KAAf;QAEA3C,MAAM,GAAOA,MAAM,MAAN,EAAb;YACM4C,gBAAgB,GAAG7C,KAAI,CAACgB,KAAL,CAAW6B,gBAAX,IAA+B5B,QAAxD;;YAEI4B,gBAAgB,IAAInB,QAAQ,GAAG1B,KAAI,CAACmC,SAAxC,EAAmD;cAC3C5B,UAAU,KAAKA,UAAU,KAAK,IAAf,IAAuBA,UAAU,CAAC6B,OAAX,CAAmB,QAAnB,IAA+B,CAAC,CAA5D,CAAd,EAA8E;;;;UAG9EnC,MAAM,CAAC6C,MAAP,CAAcL,KAAd,EAAqB,CAArB;UACAE,UAAQ,GAAG,IAAX;SALJ,MAMO,IAAI1C,MAAM,CAACmC,OAAP,CAAeV,QAAf,IAA2B,CAAC,CAAhC,EAAmC;;SAAnC,MAEA;cACCnB,UAAU,KAAKA,UAAU,KAAK,IAAf,IAAuBA,UAAU,CAAC6B,OAAX,CAAmB,QAAnB,IAA+B,CAAC,CAA5D,CAAd,EAA8E;;;;UAG9EnC,MAAM,CAACwC,KAAD,CAAN,GAAgBf,QAAhB;UACAkB,UAAQ,GAAG,IAAX;;;QAEJ5C,KAAI,CAACqC,QAAL,CAAc;UACVpC,MAAM;SADV,EAEG;cACO8C,UAAU,GAAG/C,KAAI,CAACqB,KAAL,CAAWpB,MAA9B;UACAqB,cAAe,CAAC;YACZJ,KAAK,OADO;YAEZC,KAAK,OAFO;YAGZlB,MAAM,EAAE8C,UAHI;YAIZT,KAAK,EAAE,KAJK;YAKZE,QAAQ,YALI;YAMZD,QAAQ;WANG,CAAf;SAJJ;;KAjEA;;;;;;;gBA9OD,GAAP;QACUlC,eAAA;QACF2C,wBADE;QAEFC,4BAFE;QAGFC,cAHE;QAIF3B,cAJE;QAKFO,gBALE;QAMFqB,0BANE;QAOF3B,kCAPE;QAQF4B,sBARE;QAUApC,KAAK,GAAG,KAAKA,KAAnB;QACMqC,aAAa,GAAG,KAAKC,gBAAL,EAAtB;QAGMC,UAAU,GAAe,EAA/B;IAEA7D,gBAAgB,CAAC8D,OAAjB,CAAyB,UAAAC,IAAA;UACjBA,IAAI,KAAK,OAAb,EAAsB;;;;MAGrBF,UAAkB,CAACE,IAAD,CAAlB,GAA2BzC,KAAK,CAACyC,IAAD,CAAhC;KAJL;;QAOMC,+CAAA;QAAEC,0CAAF;QAAsBC,sCAAtB;;WAECC,mBAAA,CAAChE,aAAD;MACHiE,GAAG,EAAEA,kBAAG,CAAC,IAAD,EAAO,SAAP;MACRV,QAAQ,EAAEA;MACVJ,SAAS,EAAKnE,MAAM,CAAC,SAAD,EAAYqE,IAAZ,CAAN,MAAA,GAA2BF;MACzClB,KAAK,EAAEA;KAJJ,EAMH+B,mBAAA,MAAA;MAAKb,SAAS,EAAEnE,MAAM,CAAC,cAAD;MAAkBiF,GAAG,EAAEA,kBAAG,CAAC,IAAD,EAAO,eAAP;KAAhD,CANG,EAOHD,mBAAA,CAACE,KAAD;MACID,GAAG,EAAEA,kBAAG,CAAC,IAAD,EAAO,OAAP;MACRhC,KAAK,EAAEqB;OACHI,WAHR,CAPG,EAYHM,mBAAA,MAAA;MAAKb,SAAS,EAAE7D;MAAQ2E,GAAG,EAAEA,kBAAG,CAAC,IAAD,EAAO,eAAP;MAAyBhC,KAAK,EAAE;QAC5DkC,SAAS,EAAKX,aAAa,MAAb,GAAiB,CAAC,KAAKlB,SAAN,GAAkBZ,IAAnC;;KADlB,EAGKC,cAAc,IAAIqC,mBAAA,MAAA;MAAKb,SAAS,EAAE1D;MAAcwE,GAAG,EAAEA,kBAAG,CAAC,IAAD,EAAO,gBAAP;MAA2BhC,KAAK,EAAE;QAAEmC,KAAK,EAAE,KAAKjD,KAAL,CAAWiC;;KAA5F,CAHvB,EAIIY,mBAAA,MAAA;MAAKb,SAAS,EAAE9D;MAAO4E,GAAG,EAAEA,kBAAG,CAAC,IAAD,EAAO,cAAP;MAAwBhC,KAAK,EAAE6B;KAA9D,CAJJ,EAKK,KAAKO,YAAL,CAAkBN,gBAAlB,CALL,CAZG,CAAP;GA1BG;;4BAiDC,GAAR,UAA2BV,IAA3B,EAAyCD,WAAzC;QACUkB,eAAe,GAAG,UAACC,WAAD;aAAmDlB,IAAI,KAAK,YAAT,GACrE;QAAEmB,SAAS,EAAE,SAAOD,WAAP,MAAA,GAAsBnB;OADkC,GAErE;QAAEqB,UAAU,EAAE,SAAOF,WAAP,MAAA,GAAsBnB;OAFiC;KAA3E;;QAIMU,kBAAkB,gBAA6BQ,eAAe,CAAC,OAAD,EAApE;;QACMP,gBAAgB,gBAA6BO,eAAe,CAAC,KAAKnD,KAAL,CAAWoD,WAAZ,EAAlE;;WACO;MAAET,kBAAkB,oBAApB;MAAsBC,gBAAgB;KAA7C;GAPI;;sBAUD,GAAP,UAAoBA,gBAApB;oBAAA;;QACUvD,eAAA;QAAE6C,cAAF;QAAQ3B,cAAR;QAAcgD,0BAAd;QACAlB,aAAa,GAAG,KAAKC,gBAAL,EAAtB;QACMrD,MAAM,GAAG,KAAKoB,KAAL,CAAWpB,MAA1B;SAEKuE,aAAL,GAAqB,EAArB;;QACID,UAAJ,EAAgB;aACLtE,MAAM,CAACwE,GAAP,CAAW,UAACrD,GAAD,EAAMsD,CAAN;eACNb,mBAAA,MAAA;UAAKb,SAAS,EAAEnE,MAAM,CAAC,OAAD,EAAUqE,IAAV;UAC1BY,GAAG,EAAEa,mBAAI,CAAC3E,KAAD,EAAO,eAAP,EAAwB0E,CAAxB;UACTE,GAAG,EAAEF;wBACOA;sBACFtD;UACVU,KAAK,eACE8B;YACHI,SAAS,EAAKX,aAAa,MAAb,GAAiBjC,GAAG,GAAGG,IAAvB;;SAPd,CAAR;OADG,CAAP;;;;GAPD;;2BAqBA,GAAP;oBAAA;;SACSsD,KAAL,GAAa,IAAIC,KAAJ,CAAU,KAAKC,OAAL,CAAaC,UAAb,EAAV,EAAqC;MAC9CC,SAAS,EAAEC,QAAQ,CAACC;KADX,EAEVC,EAFU,CAEP,WAFO,EAEM,UAAAlF,CAAA;UACTG,gBAAA;UACF6C,cADE;UAEF3B,cAFE;UAGFhB,0BAHE;;UAMFA,UAAU,KAAK,IAAnB,EAAyB;QACrBL,CAAC,CAACmF,IAAF;;;;UAGEjF,UAAU,GAAGF,CAAC,CAACE,UAArB;UACMK,MAAM,GAAGL,UAAU,CAACK,MAA1B;UACMN,KAAK,GAAGD,CAAC,CAACC,KAAhB;UACMmF,aAAa,GAAGtF,KAAI,CAACuF,KAAL,CAAWD,aAAjC;UACME,aAAa,GAAGxF,KAAI,CAACwF,aAA3B;UACMC,YAAY,GAAGvC,IAAI,KAAK,YAA9B;;UACMwC,UAAU,GAAG1F,KAAI,CAAC2F,aAAL,CAAmBC,qBAAnB,EAAnB;;UACMC,MAAM,GAAGC,6BAAoB,CAAC9F,KAAI,CAAC+E,OAAL,CAAaC,UAAb,EAAD,CAAnC;UACMe,SAAS,GAAGC,4BAAmB,CAACH,MAAD,EAAS,CAC1C3F,CAAC,CAAC+F,OAAF,GAAYP,UAAU,CAACQ,IADmB,EAE1ChG,CAAC,CAACiG,OAAF,GAAYT,UAAU,CAACU,GAFmB,CAAT,CAArC;MAIAL,SAAS,CAAC,CAAD,CAAT,IAAgBP,aAAa,CAACa,UAA9B;MACAN,SAAS,CAAC,CAAD,CAAT,IAAgBP,aAAa,CAACc,SAA9B;MACAP,SAAS,CAACN,YAAY,GAAG,CAAH,GAAO,CAApB,CAAT,IAAmCzF,KAAI,CAACmC,SAAL,GAAiBZ,IAApD;MAEApB,KAAK,CAAC4F,SAAN,GAAkBA,SAAlB;MACA5F,KAAK,CAAC0F,MAAN,GAAeA,MAAf;UAEIU,SAAS,GAAGhG,UAAU,IAAIA,UAAU,CAAC6B,OAAX,CAAmB,KAAnB,IAA4B,CAAC,CAA3D;UACIoE,YAAY,GAAGjG,UAAU,IAAIA,UAAU,CAAC6B,OAAX,CAAmB,QAAnB,IAA+B,CAAC,CAAjE;UACIqE,YAAY,GAAGlG,UAAU,IAAIA,UAAU,CAAC6B,OAAX,CAAmB,QAAnB,IAA+B,CAAC,CAAjE;;UAEI3B,MAAM,KAAK6E,aAAf,EAA8B;YACtBiB,SAAJ,EAAe;UACXrG,CAAC,CAACmF,IAAF;;;;QAGJlF,KAAK,CAAC+B,SAAN,GAAkB,IAAlB;QACA/B,KAAK,CAACM,MAAN,GAAeT,KAAI,CAAC0G,YAApB,CAN0B;OAA9B,MAQO,IAAIC,cAAQ,CAAClG,MAAD,EAASrB,KAAT,CAAZ,EAA6B;YAC5BoH,YAAY,IAAIC,YAApB,EAAkC;UAC9BvG,CAAC,CAACmF,IAAF;;;;QAGJlF,KAAK,CAACM,MAAN,GAAeA,MAAf,CALgC;OAA7B,MAOA;QACHP,CAAC,CAACmF,IAAF;eACO,KAAP;;;MAEJrF,KAAI,CAACM,WAAL,CAAiBJ,CAAjB;KAvDS,EAwDVkF,EAxDU,CAwDP,MAxDO,EAwDC,KAAK1E,MAxDN,EAwDc0E,EAxDd,CAwDiB,SAxDjB,EAwD4B,KAAKnD,SAxDjC,CAAb;SAyDKI,QAAL,CAAc;MAAEpC,MAAM,EAAE,KAAKe,KAAL,CAAW4F,aAAX,IAA4B;KAApD;GA1DG;;8BA4DA,GAAP;SACS/B,KAAL,CAAWgC,KAAX;GADG;;4BAGA,GAAP,UAA0BC,SAA1B;QACQA,SAAS,CAACF,aAAV,KAA4B,KAAK5F,KAAL,CAAW4F,aAA3C,EAA0D;;WAEjDvE,QAAL,CAAc;QAAEpC,MAAM,EAAE,KAAKe,KAAL,CAAW4F,aAAX,IAA4B;OAApD;;GAHD;;;;;;;;oBAWA,GAAP,UAAkB3G,MAAlB;SACSoC,QAAL,CAAc;MACVpC,MAAM;KADV;GADG;;;;;;;;mBAUA,GAAP;WACW,KAAKoB,KAAL,CAAWpB,MAAlB;GADG;;;;;;;;sBAQA,GAAP,UAAoBmB,GAApB;QACYG,sBAAA;QACFiE,aAAa,GAAG,KAAKA,aAA3B;SAEKrD,SAAL,GAAiBf,GAAjB;IACAoE,aAAa,CAAC1D,KAAd,CAAoBkC,SAApB,GAAmC,KAAKV,gBAAL,QAAA,GAA2B,CAAClC,GAAD,GAAOG,IAAlC,QAAnC;QAEMtB,MAAM,GAAG,KAAKoB,KAAL,CAAWpB,MAA1B;SACKuE,aAAL,CAAmBhB,OAAnB,CAA2B,UAACuD,EAAD,EAAKrC,CAAL;UACnB,CAACqC,EAAL,EAAS;;;;MAGTA,EAAE,CAACjF,KAAH,CAASkF,OAAT,GAAmB,CAAC5F,GAAD,GAAOnB,MAAM,CAACyE,CAAD,CAAb,GAAmB,CAAnB,GAAuB,MAAvB,GAAgC,OAAnD;KAJJ;GARG;;;;;;;;gBAoBA,GAAP;SACSa,KAAL,CAAW0B,MAAX;GADG;;;;;;;;gBAQA,GAAP,UAAc7F,GAAd;SACSmE,KAAL,CAAW2B,MAAX,CAAkB9F,GAAlB;GADG;;iBAsHC,GAAR,UAAgBlB,CAAhB;QACYC,eAAA;QAAOe,eAAP;QAAcC,eAAd;QACFH,KAAK,GAAG,KAAKA,KAAnB;QAEIkC,iBAAA;QAAM3B,iBAAN;QAAY4F,mBAAZ;QAAmBC,mCAAnB;QACA5F,qCADA;QAEAC,mBAFA;;QAIE4F,aAAa,GAAGrG,KAAK,CAACqG,aAAN,IAAwB,UAAAC,CAAA;aAAKA,CAAA;KAAnD;;QACM7B,YAAY,GAAGvC,IAAI,KAAK,YAA9B;QACMqE,SAAS,GAAGvB,4BAAmB,CAAC7F,KAAK,CAAC0F,MAAP,EAAe,CAAC3E,KAAD,EAAQC,KAAR,CAAf,CAArC;QACM4E,SAAS,GAAG5F,KAAK,CAAC4F,SAAxB;QACMyB,OAAO,GAAGD,SAAS,CAAC,CAAD,CAAT,GAAexB,SAAS,CAAC,CAAD,CAAxC;QACM0B,OAAO,GAAGF,SAAS,CAAC,CAAD,CAAT,GAAexB,SAAS,CAAC,CAAD,CAAxC;QACIjF,OAAO,GAAG4G,IAAI,CAACC,KAAL,CAAWlC,YAAY,GAAGgC,OAAH,GAAaD,OAApC,CAAd;QACI9F,QAAQ,GAAGC,UAAU,CAAC,CAACb,OAAO,GAAGS,IAAX,EAAkBK,OAAlB,CAA0BH,KAAK,IAAI,CAAnC,CAAD,CAAzB;QACMmG,UAAU,GAAGT,KAAM,CAACU,KAAP,GAAeC,IAAf,CAAoB,UAACC,CAAD,EAAIC,CAAJ;aAC5BN,IAAI,CAACO,GAAL,CAASvG,QAAQ,GAAGqG,CAApB,IAAyBL,IAAI,CAACO,GAAL,CAASvG,QAAQ,GAAGsG,CAApB,CAAhC;KADe,CAAnB;;QAIIJ,UAAU,CAACM,MAAX,IAAqBR,IAAI,CAACO,GAAL,CAASL,UAAU,CAAC,CAAD,CAAV,GAAgBrG,IAAhB,GAAwBT,OAAjC,IAA4CsG,aAArE,EAAqF;MACjF1F,QAAQ,GAAGkG,UAAU,CAAC,CAAD,CAArB;MACA9G,OAAO,GAAGY,QAAQ,GAAGH,IAArB;;;QAEAC,cAAJ,EAAoB;UACV2G,UAAU,GAAGjF,IAAI,KAAK,YAAT,GACb,CAACsE,OAAD,EAAU1G,OAAV,CADa,GAEb,CAACA,OAAD,EAAU2G,OAAV,CAFN;WAGK5F,cAAL,CAAoBC,KAApB,CAA0BC,OAA1B,IAAqC,+DACjCoG,UAAU,CAAC1D,GAAX,CAAe,UAAA6C,CAAA;eAAQA,CAAC,OAAJ;OAApB,EAA8Bc,IAA9B,CAAmC,IAAnC,CADiC,MAArC;WAGKvG,cAAL,CAAoBwG,SAApB,GAAgC,KAAGhB,aAAc,CAAC3F,QAAD,CAAjD;;;IAEJvB,KAAK,CAACM,MAAN,CAAa6H,YAAb,CAA0B,UAA1B,EAAsC5G,QAAtC;IACAvB,KAAK,CAACM,MAAN,CAAaqB,KAAb,CAAmBkC,SAAnB,GAAkC,KAAKV,gBAAL,QAAA,GAA2BxC,OAA3B,QAAlC;WAEOA,OAAP;GApCI;;0BAuCA,GAAR;WACW,KAAKE,KAAL,CAAWkC,IAAX,KAAoB,YAApB,GAAmC,YAAnC,GAAkD,YAAzD;GADI;;EAvYMqF,mBAAA,GAA4B;IACtCvF,SAAS,EAAE,EAD2B;IAEtCE,IAAI,EAAE,YAFgC;IAGtC3B,IAAI,EAAE,CAHgC;IAItCO,KAAK,EAAE;MAAE0G,KAAK,EAAE,MAAT;MAAiBC,MAAM,EAAE;KAJM;IAKtCrB,aAAa,EAAE,CALuB;IAMtCD,KAAK,EAAE,EAN+B;IAOtC1F,KAAK,EAAE,CAP+B;IAQtCH,cAAc,EAAE,cARsB;IAStChB,WAAW,EAAE,cATyB;IAUtCI,MAAM,EAAE,cAV8B;IAWtCuB,SAAS,EAAE,cAX2B;IAYtCT,cAAc,EAAE,KAZsB;IAatC6F,aAAa,EAAE,UAAAC,CAAA;aAAKA,CAAA;KAbkB;IActCV,aAAa,EAAE,EAduB;IAetCxC,WAAW,EAAE,QAfyB;IAgBtCnB,WAAW,EAAE,SAhByB;IAiBtC1C,UAAU,EAAE,KAjB0B;IAkBtCgE,UAAU,EAAE,IAlB0B;IAmBtC1B,gBAAgB,EAAE;GAnBR;eA0YlB;EA3YoCgB,oBAApC;;;;;;;;;;;ACXA,KAAK,IAAMJ,IAAX,IAAmBiF,MAAnB,EAA2B;EACtBH,MAAc,CAAC9E,IAAD,CAAd,GAAwBiF,MAAc,CAACjF,IAAD,CAAtC;;;;;"}